<?php
/**
 * Magecheckout
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magecheckout.com license that is
 * available through the world-wide-web at this URL:
 * http://wiki.magecheckout.com/general/license.html
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Magecheckout
 * @package     Magecheckout_SecuredCheckout
 * @copyright   Copyright (c) 2015 Magecheckout (http://www.magecheckout.com/)
 * @license     http://wiki.magecheckout.com/general/license.html
 */
?>
<?php $_shippingRateGroups = $this->getShippingRates(); ?>
<?php if (!$_shippingRateGroups) : ?>
    <p><?php echo $this->__('Please specify the shipping address to see available options.') ?></p>
<?php else : ?>
    <dl class="sp-methods ">
        <?php $_sole = count($_shippingRateGroups) == 1;
        foreach ($_shippingRateGroups as $code => $_rates): ?>
            <dt><?php  $this->escapeHtml($this->getCarrierName($code)) ?></dt>
            <dd>
                <ul>
                    <?php $_sole = $_sole && count($_rates) == 1;
                    foreach ($_rates as $_rate): ?>
                        <li class="list-unstyled rowspan " >
                            <?php if ($_rate->getErrorMessage()): ?>
                                <ul class="messages">
                                    <li class="error-msg">
                                        <ul>
                                            <li><?php echo $this->escapeHtml($_rate->getErrorMessage()) ?></li>
                                        </ul>
                                    </li>
                                </ul>
                            <?php else: ?>
                            <?php if ($_sole) : ?>
                                <span class="no-display float"><input name="shipping_method" type="radio"
                                                                value="<?php echo $_rate->getCode() ?>"
                                                                id="s_method_<?php echo $_rate->getCode() ?>"
                                                                checked="checked"/></span>
                            <?php else: ?>
                            <input name="shipping_method" type="radio"
                                   value="<?php echo $_rate->getCode() ?>"
                                   id="s_method_<?php echo $_rate->getCode() ?>"<?php if ($_rate->getCode() === $this->getAddressShippingMethod() || $_rate->getCode() === $this->getDefaultShippingMethod()) echo ' checked="checked"' ?>
                                   class="radio s_method float "/>
                            <?php endif; ?>
                                <label
                                    for="s_method_<?php echo $_rate->getCode() ?>"><?php echo $this->escapeHtml($_rate->getMethodTitle()) ?>
                                    <?php $_excl = $this->getShippingPrice($_rate->getPrice(), $this->helper('tax')->displayShippingPriceIncludingTax()); ?>
                                    <?php $_incl = $this->getShippingPrice($_rate->getPrice(), true); ?>
                                    <?php echo $_excl; ?>
                                    <?php if ($this->helper('tax')->displayShippingBothPrices() && $_incl != $_excl): ?>
                                        (<?php echo $this->__('Incl. Tax'); ?><?php echo $_incl; ?>)
                                    <?php endif; ?>
                                </label>
                                <!--Integration Magestore_StorePickup-->
                            <?php if ($_rate->getCode() == 'storepickup_storepickup'): ?>
                                <div id="free-location-box"
                                     style="display:none;">
                                    <?php echo $this->getChildHtml('storepickup'); ?>
                                </div>
                                <script type="text/javascript">
                                    if ($('s_method_storepickup_storepickup').checked) {
                                        $('free-location-box').show();
                                    }
                                    $('s_method_storepickup_storepickup').observe('click', function () {
                                        if ($('s_method_storepickup_storepickup').checked) {
                                            $('free-location-box').show();
                                        } else {
                                            $('free-location-box').hide();
                                        }
                                    })
                                </script>
                            <?php endif ?>
                            <?php endif ?>
                        </li>
                    <?php endforeach; ?>
                </ul>
            </dd>
        <?php endforeach; ?>
        <?php echo $this->getChildHtml('available.extra') ?>
    </dl>
    <div class="validation-advice shipping-method" style="display: none;"></div>
<?php endif; ?>
<script>
    //<![CDATA[
    securedCheckoutShippingMethod.initShipping();
    //]]>
</script>